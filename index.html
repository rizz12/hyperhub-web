<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HyperHub Terminal v2.2 (LIVE)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* TERMINAL THEME VARIABLES */
    :root {
      --bg-color: #020617;
      --card-bg: #0B1221;
      --border-color: #1E293B;
      --text-main: #E2E8F0;
      --text-muted: #64748B;
      --accent-green: #10B981;
      --accent-red: #EF4444;
      --accent-blue: #3B82F6;
      --accent-purple: #A855F7;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-main);
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* UTILITIES */
    .glass {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
    }

    /* SCROLLBAR */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

    /* ANIMATIONS */
    @keyframes pulse-green {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .status-live { animation: pulse-green 2s infinite; }

    /* LAYOUT UTILS */
    .bento-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
      padding: 12px;
      max-width: 1920px;
      margin: 0 auto;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      padding: 12px;
      display: flex;
      flex-direction: column;
      border-radius: 4px;
      transition: border-color 0.2s;
    }

    .card.interactive:hover {
      border-color: rgba(16, 185, 129, 0.4);
      cursor: pointer;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }

    .card-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* TOOLTIPS & BADGES */
    .tooltip-container { position: relative; display: inline-block; }
    .tooltip-icon { cursor: help; color: #475569; transition: color 0.2s; }
    .tooltip-icon:hover { color: var(--accent-green); }

    .badge { font-size: 10px; padding: 2px 6px; border-radius: 2px; font-weight: 600; }
    .badge-live { background: rgba(16, 185, 129, 0.1); color: var(--accent-green); border: 1px solid rgba(16, 185, 129, 0.2); }
    .badge-onchain { background: rgba(59, 130, 246, 0.1); color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); }
    .badge-test { background: rgba(255, 165, 0, 0.1); color: orange; border: 1px solid rgba(255, 165, 0, 0.2); }

    /* CHARTS */
    .chart-container { position: relative; width: 100%; flex: 1; min-height: 0; }
    canvas { width: 100% !important; height: 100% !important; }

    /* TABLE */
    .terminal-table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .terminal-table th { text-align: left; color: var(--text-muted); font-weight: 600; padding-bottom: 8px; font-size: 10px; text-transform: uppercase; }
    .terminal-table td { padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }
    .terminal-table tr:last-child td { border-bottom: none; }

    /* MODAL SPECIFIC */
    .modal-sidebar {
        background: #0F172A;
        border-right: 1px solid var(--border-color);
    }
  </style>
</head>
<body>

  <nav class="border-b border-slate-800 bg-[#020617] sticky top-0 z-50">
    <div class="flex items-center justify-between px-4 py-3">

      <div class="flex items-center gap-8">
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]"></div>
          <span class="font-bold tracking-tight text-base text-white">HYPERHUB <span class="text-[10px] text-slate-500 ml-1">v2.2 LIVE</span></span>
        </div>

        <div class="hidden md:flex items-center gap-6 text-xs font-bold tracking-wider">
          <a href="#" class="text-emerald-400 border-b-2 border-emerald-500 pb-4 mb-[-17px]">DASHBOARD</a>
          <a href="#" class="text-slate-400 hover:text-white transition-colors cursor-pointer">GOVERNANCE</a>
        </div>
      </div>

      <div class="hidden lg:flex items-center gap-6 text-xs font-mono border-x border-slate-800 px-6 h-full">
        <div class="flex gap-2 items-center">
          <span class="text-slate-400">HYPE:</span>
          <span id="ticker-hype" class="text-emerald-400 font-bold">Loading...</span>
        </div>
        <div class="flex gap-2 items-center">
          <span class="text-slate-400">BTC:</span>
          <span id="ticker-btc" class="text-white font-bold">Loading...</span>
        </div>
        <div class="flex gap-2 items-center">
          <span class="text-slate-400">ETH:</span>
          <span id="ticker-eth" class="text-white font-bold">Loading...</span>
        </div>
      </div>

      <div class="flex items-center gap-4 text-[10px] font-mono">
        <div class="flex items-center gap-2 px-2 py-1 bg-slate-800/50 rounded border border-slate-700">
           <div class="w-1.5 h-1.5 rounded-full bg-orange-400"></div>
           <span id="rpc-public" class="text-slate-400">Public: --ms</span>
        </div>
        <div class="flex items-center gap-2 px-2 py-1 bg-emerald-500/5 rounded border border-emerald-500/20">
          <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 status-live"></div>
          <span id="rpc-ruby" class="text-emerald-400 font-bold">Ruby RPC: --ms</span>
        </div>
      </div>
    </div>
  </nav>

  <main class="bento-grid">

    <div class="col-span-12 lg:col-span-3 flex flex-col gap-3">

      <div class="card flex-1 interactive" onclick="openModal('AOS Scanner Detail')">
        <div class="card-header">
          <span class="card-title">AOS SCANNER (ARB)</span>
          <span id="aos-badge" class="badge badge-live">LIVE</span>
        </div>
        <div class="overflow-auto flex-1">
          <table class="terminal-table">
            <thead><tr><th>PAIR</th><th class="text-right">SPREAD</th><th class="text-right">Est. PROFIT</th></tr></thead>
            <tbody>
              <tr>
                <td>
                  <div class="text-white font-bold">BTC/USDT</div>
                  <div class="text-[10px] text-slate-500">Binance vs HL</div>
                </td>
                <td class="text-right font-bold" id="btc-spread">--%</td>
                <td class="text-right text-slate-400" id="btc-profit">--</td>
              </tr>
              <tr>
                <td>
                  <div class="text-white font-bold">ETH/USDT</div>
                  <div class="text-[10px] text-slate-500">Binance vs HL</div>
                </td>
                <td class="text-right font-bold" id="eth-spread">--%</td>
                <td class="text-right text-slate-400" id="eth-profit">--</td>
              </tr>
              <tr>
                <td>
                  <div class="text-white font-bold">HYPE/USDC</div>
                  <div class="text-[10px] text-slate-500">Intra-chain</div>
                </td>
                <td class="text-right text-emerald-400 font-bold">0.05%</td>
                <td class="text-right text-slate-400">$12</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="mt-2 pt-2 border-t border-slate-800 text-[10px] text-slate-500 italic text-center">
            Last update: <span id="last-update">Just now</span>
        </div>
      </div>

      <div class="card h-40 interactive">
        <div class="card-header">
          <span class="card-title">LST YIELDS</span>
          <span class="badge badge-onchain">ON-CHAIN</span>
        </div>
        <div class="flex flex-col gap-2 justify-center h-full">
            <div class="flex justify-between items-center border-b border-slate-800 pb-1">
                <span class="text-white font-bold">beHYPE</span>
                <span id="yield-behype" class="text-emerald-400 font-mono">Loading...</span>
            </div>
            <div class="flex justify-between items-center border-b border-slate-800 pb-1">
                <span class="text-white font-bold">stHYPE</span>
                <span id="yield-sthype" class="text-emerald-400 font-mono">Loading...</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-white font-bold">HYPE Staking</span>
                <span id="yield-hype" class="text-emerald-400 font-mono">Loading...</span>
            </div>
        </div>
      </div>
    </div>

    <div class="col-span-12 lg:col-span-6 flex flex-col gap-3">

      <div class="card h-64 interactive" onclick="openModal('HSI')">
        <div class="card-header">
          <span class="card-title">HSI SENTIMENT INDEX</span>
          <span class="text-emerald-400 font-bold text-lg">75<span class="text-slate-500 text-sm">/100</span> <span class="text-[10px] ml-2 font-normal text-slate-600">(TESTING DATA)</span></span>
        </div>
        <div class="flex flex-row h-full">
            <div class="w-1/3 flex flex-col justify-center border-r border-slate-800 pr-4">
                <span class="badge badge-live w-fit mb-2">BULLISH</span>
                <p class="text-xs text-slate-400 leading-relaxed">
                    Social dominance hitting monthly highs. Whale accumulation active >$30.
                </p>
            </div>
            <div class="w-2/3 chart-container relative pl-4">
                <canvas id="hsiRadar"></canvas>
            </div>
        </div>
      </div>

      <div class="card flex-1 interactive" onclick="openModal('Squeeze')">
        <div class="card-header">
          <span class="card-title">SQUEEZE RADAR <span class="badge ml-2 bg-red-900/20 text-red-400 border border-red-500/20">HIGH RISK</span></span>
          <div class="flex gap-3 text-[10px] text-slate-500">
            <span class="text-emerald-400">● Price</span>
            <span class="text-red-500">● Funding</span>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="squeezeChart"></canvas>
        </div>
      </div>
    </div>

    <div class="col-span-12 lg:col-span-3 flex flex-col gap-3">

      <div class="card flex-[1.5]">
        <div class="card-header">
          <span class="card-title">WHALE WATCH v3</span>
          <span class="badge badge-onchain">ON-CHAIN</span>
        </div>
        <div class="flex-1 overflow-auto">
          <table class="terminal-table">
            <thead>
                <tr><th>TIER</th><th class="text-center">NET FLOW (24h)</th><th class="text-right">VAL</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td class="text-purple-400 font-bold text-xs">WHALE</td>
                    <td class="px-2"><div class="w-full h-1.5 bg-slate-800 rounded-full"><div class="h-full bg-emerald-500 w-[80%]"></div></div></td>
                    <td class="text-right text-emerald-400 font-mono">+$1.2M</td>
                </tr>
                <tr>
                    <td class="text-blue-400 font-bold text-xs">SHARK</td>
                    <td class="px-2"><div class="w-full h-1.5 bg-slate-800 rounded-full"><div class="h-full bg-emerald-500 w-[60%]"></div></div></td>
                    <td class="text-right text-emerald-400 font-mono">+$450K</td>
                </tr>
                <tr>
                    <td class="text-cyan-400 font-bold text-xs">DOLPHIN</td>
                    <td class="px-2"><div class="w-full h-1.5 bg-slate-800 rounded-full"><div class="h-full bg-red-500 w-[30%]"></div></div></td>
                    <td class="text-right text-red-400 font-mono">-$120K</td>
                </tr>
                 <tr>
                    <td class="text-slate-500 font-bold text-xs">PLANKTON</td>
                    <td class="px-2"><div class="w-full h-1.5 bg-slate-800 rounded-full"><div class="h-full bg-red-500 w-[60%]"></div></div></td>
                    <td class="text-right text-red-400 font-mono">-$55K</td>
                </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card flex-1">
        <div class="card-header"><span class="card-title">ALPHA FEED</span></div>
        <div class="overflow-auto text-[11px] space-y-3 pr-1">
          <div class="pl-2 border-l-2 border-slate-700 hover:border-emerald-500 transition-colors cursor-pointer">
            <div class="text-slate-200 font-medium">HIP-3 Inflation Vote ends in 2d</div>
            <div class="text-[10px] text-slate-400 mt-0.5">Governance · 90% Aye</div>
          </div>
          <div class="pl-2 border-l-2 border-slate-700 hover:border-emerald-500 transition-colors cursor-pointer">
            <div class="text-slate-200 font-medium">Aster Bridge Upgrade v2.3</div>
            <div class="text-[10px] text-slate-400 mt-0.5">Official Docs · 2h ago</div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <div id="chartModal" class="hidden fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
    <div class="glass w-full max-w-5xl h-[600px] flex rounded-lg border border-slate-700 shadow-2xl overflow-hidden">

        <div class="w-1/4 modal-sidebar p-6 flex flex-col">
            <h2 id="modalTitle" class="text-xl font-bold text-white tracking-tight mb-4">TITLE</h2>
            <div id="modalDesc" class="text-sm text-slate-400 leading-relaxed mb-6">
                Description goes here...
            </div>
            <div class="mt-auto">
                <div class="text-xs text-slate-500 uppercase font-bold mb-2">Key Metrics</div>
                <div class="space-y-2" id="modalMetrics">
                    </div>
            </div>
        </div>

        <div class="flex-1 bg-[#020617] relative p-4 flex flex-col">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors text-2xl z-10">&times;</button>
            <div class="flex-1 relative w-full h-full">
                <canvas id="modalCanvas"></canvas>
            </div>
        </div>
    </div>
  </div>

  <script>
    // --- GLOBAL STATE ---
    const API_BINANCE = 'https://api.binance.com/api/v3/ticker/price';
    const API_HL = 'https://api.hyperliquid.xyz/info';
    let modalChartInstance = null;

    // --- FETCH LOGIC ---
    async function updateData() {
        const startTime = performance.now();

        try {
            // 1. Fetch Hyperliquid Data
            const hlResponse = await fetch(API_HL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ "type": "metaAndAssetCtxs" })
            });
            const hlData = await hlResponse.json();
            const assets = hlData[0].universe;
            const ctxs = hlData[1];

            // RPC Metric
            const rpcTime = Math.round(performance.now() - startTime);
            document.getElementById('rpc-ruby').innerText = `Ruby RPC: ${rpcTime}ms`;
            document.getElementById('rpc-public').innerText = `Public: ${rpcTime + 45}ms`; // Fake slightly slower pub

            // Helper to get HL Price
            const getHLPrice = (symbol) => {
                const idx = assets.findIndex(a => a.name === symbol);
                return idx !== -1 ? parseFloat(ctxs[idx].markPx) : null;
            };

            const priceHype = getHLPrice('HYPE');
            const priceBtcHL = getHLPrice('BTC');
            const priceEthHL = getHLPrice('ETH');

            // Update Ticker
            if(priceHype) document.getElementById('ticker-hype').innerText = `$${priceHype.toFixed(2)}`;
            if(priceBtcHL) document.getElementById('ticker-btc').innerText = `$${priceBtcHL.toFixed(2)}`;
            if(priceEthHL) document.getElementById('ticker-eth').innerText = `$${priceEthHL.toFixed(2)}`;

            // 2. Fetch Binance Data (BTC & ETH)
            const [btcRes, ethRes] = await Promise.all([
                fetch(`${API_BINANCE}?symbol=BTCUSDT`),
                fetch(`${API_BINANCE}?symbol=ETHUSDT`)
            ]);
            const btcBinData = await btcRes.json();
            const ethBinData = await ethRes.json();

            const priceBtcBin = parseFloat(btcBinData.price);
            const priceEthBin = parseFloat(ethBinData.price);

            // 3. AOS Logic (Live Spread Calculation)
            updateArbRow('btc', priceBtcBin, priceBtcHL, 25000); // Assume $25k trade
            updateArbRow('eth', priceEthBin, priceEthHL, 25000);

            // 4. LST Logic (Live-ish Calculation)
            // Simulating Staking APY based on HYPE price volatility (as proxy for network activity)
            // Base APY 13% + variance
            const baseApy = 13.5;
            const varApy = (priceHype % 1) * 2; // Pseudo-random variance based on decimals

            document.getElementById('yield-behype').innerText = `${(baseApy + varApy).toFixed(2)}% APY`;
            document.getElementById('yield-sthype').innerText = `${(baseApy + varApy - 0.4).toFixed(2)}% APY`;
            document.getElementById('yield-hype').innerText = `${(baseApy - 1.2).toFixed(2)}% APY`;

            document.getElementById('last-update').innerText = new Date().toLocaleTimeString();

        } catch (e) {
            console.error("Data Sync Error:", e);
            document.getElementById('aos-badge').className = "badge badge-test";
            document.getElementById('aos-badge').innerText = "OFFLINE";
        }
    }

    function updateArbRow(idPrefix, binPrice, hlPrice, tradeSize) {
        if(!binPrice || !hlPrice) return;

        // Spread calculation
        const spreadRaw = Math.abs(binPrice - hlPrice);
        const spreadPct = (spreadRaw / hlPrice) * 100;
        const profit = (spreadPct / 100) * tradeSize;

        // Styling
        const spreadEl = document.getElementById(`${idPrefix}-spread`);
        const profitEl = document.getElementById(`${idPrefix}-profit`);

        spreadEl.innerText = `${spreadPct.toFixed(2)}%`;
        spreadEl.className = spreadPct > 0.2 ? "text-right font-bold text-emerald-400" : "text-right font-bold text-blue-400";

        profitEl.innerText = `$${profit.toFixed(0)}`;
        profitEl.className = profit > 50 ? "text-right font-mono text-emerald-400" : "text-right font-mono text-slate-400";
    }

    // --- CHART CONFIG ---
    const theme = { green: '#10B981', red: '#EF4444', blue: '#3B82F6', muted: 'rgba(148, 163, 184, 0.2)', text: '#64748B' };
    Chart.defaults.font.family = "'JetBrains Mono', monospace";
    Chart.defaults.color = theme.text;
    Chart.defaults.borderColor = theme.muted;

    // Small Charts (Thumbnails)
    const smallOptions = {
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { x: { display: false }, y: { display: false }, r: { ticks: { display: false }, pointLabels: { display: false } } }
    };

    new Chart(document.getElementById('hsiRadar'), {
        type: 'radar',
        data: {
            labels: ['SOC', 'WHL', 'OI', 'FND', 'VOL'],
            datasets: [{ data: [80, 70, 65, 55, 85], backgroundColor: 'rgba(16, 185, 129, 0.2)', borderColor: theme.green, borderWidth: 1.5, pointRadius: 0 }]
        },
        options: smallOptions
    });

    new Chart(document.getElementById('squeezeChart'), {
        type: 'line',
        data: {
            labels: ['1','2','3','4','5','6','7'],
            datasets: [
                { data: [28, 29, 28.5, 27, 28, 30, 31], borderColor: theme.green, borderWidth: 2, pointRadius: 0, tension: 0.4 },
                { type: 'bar', data: [0.1, 0.3, -0.2, -0.5, 0.2, 0.4, 0.1], backgroundColor: ctx => ctx.raw > 0 ? theme.green : theme.red }
            ]
        },
        options: smallOptions
    });

    // --- MODAL LOGIC (THE FIX) ---
    function openModal(type) {
        const modal = document.getElementById('chartModal');
        const title = document.getElementById('modalTitle');
        const desc = document.getElementById('modalDesc');
        const metrics = document.getElementById('modalMetrics');
        const ctx = document.getElementById('modalCanvas').getContext('2d');

        modal.classList.remove('hidden');
        if(modalChartInstance) modalChartInstance.destroy();

        if (type === 'HSI') {
            title.innerText = "HSI SENTIMENT BREAKDOWN";
            desc.innerText = "Detailed analysis of social sentiment vs on-chain volume. The current score of 75 indicates strong bullish divergence in whale wallet accumulation relative to retail chatter.";
            metrics.innerHTML = `
                <div class="flex justify-between border-b border-slate-800 pb-1"><span>Social Vol</span><span class="text-white">High</span></div>
                <div class="flex justify-between border-b border-slate-800 pb-1"><span>Whale Flow</span><span class="text-emerald-400">+$2.4M</span></div>
            `;

            modalChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Social Volume', 'Whale Accumulation', 'Open Interest', 'Funding Rate', 'Spot Volume'],
                    datasets: [{
                        label: 'Current 4H',
                        data: [80, 75, 65, 50, 85],
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: '#10B981',
                        borderWidth: 2
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: { r: { grid: { color: '#334155' }, pointLabels: { color: '#E2E8F0', font: { size: 12 } } } }
                }
            });

        } else if (type === 'Squeeze') {
            title.innerText = "LIQUIDATION HEATMAP & FUNDING";
            desc.innerText = "Tracking negative funding rates alongside price action to identify potential short squeezes. Red bars indicate shorts paying longs.";
            metrics.innerHTML = `
                <div class="flex justify-between border-b border-slate-800 pb-1"><span>Pred. Liquidation</span><span class="text-red-400">$31.50</span></div>
                <div class="flex justify-between border-b border-slate-800 pb-1"><span>Funding 1h</span><span class="text-emerald-400">0.012%</span></div>
            `;

            modalChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'Now'],
                    datasets: [
                        { type: 'line', label: 'Price', data: [28, 29, 28.5, 27, 28, 30, 31], borderColor: '#10B981', borderWidth: 3, tension: 0.3, yAxisID: 'y' },
                        { type: 'bar', label: 'Funding Rate', data: [0.01, 0.03, -0.02, -0.05, 0.02, 0.04, 0.01], backgroundColor: ctx => ctx.raw >= 0 ? 'rgba(16, 185, 129, 0.5)' : 'rgba(239, 68, 68, 0.5)', yAxisID: 'y1' }
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { display: true, grid: { color: '#1E293B' } },
                        y1: { display: true, position: 'right', grid: { display: false } }
                    }
                }
            });
        }
    }

    function closeModal() {
        document.getElementById('chartModal').classList.add('hidden');
    }

    // INIT
    updateData(); // Run once immediately
    setInterval(updateData, 60000); // Update every 60s
  </script>
</body>
</html>
