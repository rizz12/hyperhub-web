<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HyperHub — Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <style>
    /* Drobná lokální úprava (pokud nemáš Tailwind utility) */
    .glass { background: rgba(255,255,255,0.03); }
    .muted { color: #9aa0a6; }
    .brand-green { color: #00ff7f; }
    .card { padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 0.5rem; }
    /* Fixní výšky pro hlavní karty */
    .card.h-fixed { height: 12rem; } /* 192px */
    .card.h-small { height: 8rem; }  /* 128px pro KPI chips */
    /* Vnitřní scroll */
    .card .scroll { height: calc(100% - 2.5rem); overflow-y: auto; }
    /* Grafy pevná výška */
    canvas { width: 100% !important; display:block; }
    #sentimentChart, #oiChart, #hsiChart, #giypChart { height: 128px !important; }
    /* Modal pro zvětšené grafy */
    .modal-backdrop { position: fixed; inset:0; background: rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:60; }
    .modal { width: min(1100px, 95%); max-height: 90vh; overflow:auto; background: #0b0b0b; padding:1rem; border-radius:0.5rem; }
    /* HIP row */
    .hip-row { cursor: pointer; }
    .hip-expanded { background: rgba(0,255,127,0.03); padding:0.75rem; border-radius:0.375rem; margin-top:0.5rem; }
    /* Analytics dropdown */
    .analytics-menu { display:none; position:absolute; background:#0b0b0b; padding:0.5rem; border-radius:0.375rem; }
    .analytics-trigger:hover + .analytics-menu, .analytics-menu:hover { display:block; }
  </style>
</head>
<body class="bg-gray-900 text-white antialiased">

  <!-- Top header -->
  <header class="glass p-4 sticky top-0 z-50">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="ruby"></span>
        <div>
          <a href="/" class="text-2xl font-bold brand-green">HyperHub</a>
          <div class="text-xs muted">Made by Ruby Nodes</div>
        </div>
      </div>
      <nav class="flex items-center gap-6 relative">
        <a href="#dashboard" class="muted hover:text-white">Dashboard</a>
        <a href="/" class="muted hover:text-white">Analytics</a>
        <a href="#governance" class="muted hover:text-white">Governance</a>
        <a href="#education" class="muted hover:text-white hidden">Education</a>
        <a href="#about" class="muted hover:text-white">About</a>
        <div class="relative">
          <button id="themeToggle" class="px-3 py-1 rounded-md glass muted">Dark</button>
        </div>
      </nav>
    </div>
  </header>

  <main class="p-6">
    <!-- Hero -->
    <section class="p-6 glass rounded-lg mt-4">
      <h1 class="text-3xl font-bold brand-green">Unlock Hyperliquid Insights</h1>
      <p class="muted">Track, Govern, Thrive.</p>

      <!-- KPI chips (kratší výška) -->
      <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mt-4">
        <div class="chip card h-small flex flex-col justify-center">
          <span class="text-xs muted">Price</span>
          <strong id="kpiPrice" class="text-lg">$--</strong>
        </div>
        <div class="chip card h-small flex flex-col justify-center">
          <span class="text-xs muted">24h</span>
          <strong id="kpiChange" class="text-lg">--</strong>
        </div>
        <div class="chip card h-small flex flex-col justify-center">
          <span class="text-xs muted">Volume</span>
          <strong id="kpiVol" class="text-lg">--</strong>
        </div>
        <div class="chip card h-small flex flex-col justify-center">
          <span class="text-xs muted">Market Cap</span>
          <strong id="kpiMcap" class="text-lg">--</strong>
        </div>
        <div class="chip card h-small flex flex-col justify-center">
          <span class="text-xs muted">Open Interest</span>
          <strong id="kpiOI" class="text-lg">--</strong>
        </div>
      </div>
    </section>

    <!-- Main grid -->
    <section id="dashboard" class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-start">

      <!-- Left column (col-span-2) -->
      <div class="col-span-2 glass p-4 rounded-lg">

        <!-- Header row inside left column -->
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-xl font-bold brand-green">Realtime Dashboard</h2>
            <div class="muted text-sm">Updated: <span id="lastUpdated">--</span></div>
          </div>
          <div class="text-right">
            <div class="text-sm muted">HYPE</div>
            <div class="text-3xl font-semibold" id="hypePrice">$--</div>
            <div class="muted text-sm" id="hypeChange">--</div>
          </div>
        </div>

        <p class="mt-3 muted">Live overview of price action, sentiment and on-chain signals.</p>

        <!-- Cards grid (3 columns inside left) -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-start">

          <!-- Realtime card (pevná výška) -->
          <div class="card self-start h-fixed">
            <div class="flex items-center justify-between">
              <div class="font-semibold">Realtime</div>
              <div class="text-xs muted">updates every 60s</div>
            </div>
            <div class="mt-3 scroll">
              <div class="text-sm muted">Price</div>
              <div id="cardPrice" class="text-xl font-bold">$--</div>
              <!-- odstraněno: volume/24h/MC pod cenou -->
              <div class="mt-3 text-sm muted">Latest trades, liquidity and depth visualizations will appear here.</div>
            </div>
          </div>

          <!-- HSI card (pentagram + components) -->
          <div class="card self-start h-fixed">
            <div class="flex items-center justify-between">
              <div class="font-semibold">HSI (Hyperliquid Sentiment Index)</div>
              <div class="text-xs muted">Main indicator</div>
            </div>
            <div class="mt-3 scroll">
              <div class="flex gap-4 items-center">
                <div style="width:110px; height:110px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#07120a,#0b1b0f); border-radius:8px;">
                  <div>
                    <div id="hsiMain" class="text-3xl font-bold brand-green text-center">62</div>
                    <div class="muted text-xs text-center">HSI</div>
                  </div>
                </div>
                <div class="flex-1">
                  <canvas id="hsiChart"></canvas>
                </div>
              </div>

              <!-- komponenty HSI -->
              <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                <div class="flex justify-between"><span>Sentiment</span><strong id="hsiSent">60</strong></div>
                <div class="flex justify-between"><span>Whales</span><strong id="hsiWhales">55</strong></div>
                <div class="flex justify-between"><span>Open Interest</span><strong id="hsiOI">50</strong></div>
                <div class="flex justify-between"><span>Funding</span><strong id="hsiFunding">48</strong></div>
                <div class="flex justify-between"><span>Liquidity</span><strong id="hsiLiq">65</strong></div>
              </div>
            </div>
          </div>

          <!-- GIYP chart -->
          <div class="card self-start h-fixed">
            <div class="font-semibold">GIYP Predictor</div>
            <div class="mt-3 scroll">
              <canvas id="giypChart"></canvas>
              <div class="muted text-xs mt-2">Governance Impact Yield Predictor</div>
            </div>
          </div>
        </div>

        <!-- Second row: News aggregator + Sentiment + Whales -->
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 items-start">

          <!-- News Aggregator (mock) -->
          <div class="card self-start h-fixed">
            <div class="flex items-center justify-between">
              <div class="font-semibold">RSS - News Aggregator</div>
              <div class="text-xs muted">mock feed</div>
            </div>
            <div id="newsList" class="mt-3 scroll">
              <!-- mock items -->
              <div class="mb-2 p-2 glass rounded">
                <a href="#" class="font-semibold">Hyperliquid integrates new AMM</a>
                <div class="muted text-xs mt-1">Source: MockNews · 2h ago</div>
              </div>
              <div class="mb-2 p-2 glass rounded">
                <a href="#" class="font-semibold">HIP-6 passes: fee burn announced</a>
                <div class="muted text-xs mt-1">Source: MockBlog · 6h ago</div>
              </div>
              <div class="mb-2 p-2 glass rounded">
                <a href="#" class="font-semibold">Large whale accumulation observed</a>
                <div class="muted text-xs mt-1">Source: MockChain · 12h ago</div>
              </div>
            </div>
          </div>

          <!-- Sentiment -->
          <div class="card self-start h-fixed">
            <div class="flex items-center justify-between">
              <div class="font-semibold">Sentiment</div>
              <div class="text-xs muted">Headlines + Reddit</div>
            </div>
            <div class="mt-3 scroll">
              <canvas id="sentimentChart"></canvas>
              <div class="mt-2 muted text-sm">Score: <span id="sentimentScore">75%</span></div>
            </div>
          </div>

          <!-- Whales -->
          <div class="card self-start h-fixed">
            <div class="flex items-center justify-between">
              <div class="font-semibold">Whales</div>
              <div class="text-xs muted">Large txs</div>
            </div>
            <div id="whaleList" class="mt-3 scroll">
              <div class="muted text-sm">Loading whales (mock)...</div>
            </div>
          </div>
        </div>

        <!-- Open Interest + MMIA -->
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
          <div class="card self-start h-fixed">
            <div class="flex items-center justify-between">
              <div class="font-semibold">Open Interest</div>
              <div class="text-xs muted">Longs vs Shorts</div>
            </div>
            <div class="mt-3 scroll">
              <canvas id="oiChart"></canvas>
              <div class="mt-2 muted text-sm">Latest OI: <span id="oiLatest">--</span></div>
            </div>
          </div>

          <div class="card self-start h-fixed">
            <div class="flex items-center justify-between">
              <div class="font-semibold">MMIA</div>
              <div class="text-xs muted">Market Maker Imbalance</div>
            </div>
            <div class="mt-3 scroll">
              <div id="mmiaIndicator" class="text-lg font-semibold">Neutral</div>
              <div class="muted text-sm mt-2">Color indicates bias: <span id="mmiaColor" class="font-semibold">—</span></div>
            </div>
          </div>
        </div>

      </div>

      <!-- Right column (governance + analytics) -->
      <aside class="glass p-4 rounded-lg">
        <div class="flex items-center justify-between">
          <div>
            <div class="font-semibold">Hyperliquid Governance</div>
            <div class="muted text-sm">Proposals & snapshot</div>
          </div>
          <div class="text-xs muted"><a href="https://hyperliquid.gitbook.io/hyperliquid-docs/hyperliquid-improvement-proposals-hips" target="_blank" class="brand-green">HIPs →</a></div>
        </div>

        <div id="govSnapshot" class="mt-3">
          <!-- mock HIP list -->
          <div id="hipsList">
            <div class="hip-row p-2 rounded hover:bg-white/5" data-hip="HIP-6">
              <div class="flex justify-between items-center">
                <div><strong>HIP-6</strong> · Fee burn mechanism</div>
                <div class="muted text-xs">Active</div>
              </div>
            </div>
            <div class="hip-row p-2 rounded hover:bg-white/5" data-hip="HIP-7">
              <div class="flex justify-between items-center">
                <div><strong>HIP-7</strong> · Staking rewards update</div>
                <div class="muted text-xs">Voting</div>
              </div>
            </div>
            <div class="hip-row p-2 rounded hover:bg-white/5" data-hip="HIP-8">
              <div class="flex justify-between items-center">
                <div><strong>HIP-8</strong> · LP incentives</div>
                <div class="muted text-xs">Draft</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <div class="font-semibold">Analytics</div>
          <div class="muted text-sm">Quick links</div>
          <div class="mt-2">
            <a href="/" class="block py-1 muted hover:text-white">Home</a>
            <div class="relative">
              <div class="analytics-trigger py-1 muted hover:text-white">Indicators ▾</div>
              <div class="analytics-menu">
                <a href="#indicator-sentiment" class="block py-1 px-2 muted hover:text-white">Sentiment</a>
                <a href="#indicator-oi" class="block py-1 px-2 muted hover:text-white">Open Interest</a>
                <a href="#indicator-hsi" class="block py-1 px-2 muted hover:text-white">HSI</a>
              </div>
            </div>
          </div>
        </div>

      </aside>

    </section>

    <!-- Education (hidden for now) -->
    <section id="education" class="mb-8 hidden">
      <div class="card">
        <div class="font-semibold">Education</div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- content omitted (hidden) -->
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-6 text-center muted text-sm">
      <div>Made by Ruby Nodes · <a href="https://rubynodes.io" class="brand-green">rubynodes.io</a></div>
    </footer>
  </main>

  <!-- Modal for enlarged charts -->
  <div id="chartModal" class="hidden">
    <div class="modal-backdrop" id="modalBackdrop" style="display:none;">
      <div class="modal">
        <div class="flex justify-between items-center">
          <div id="modalTitle" class="font-semibold">Chart</div>
          <button id="modalClose" class="px-3 py-1 glass">Close</button>
        </div>
        <div id="modalBody" class="mt-4">
          <!-- large canvas will be injected here -->
        </div>
        <div id="modalDesc" class="mt-4 muted text-sm"></div>
      </div>
    </div>
  </div>

  <!-- Inline JS: demo data, interactions -->
  <script>
    // Demo data + safe DOM helpers
    const $ = id => document.getElementById(id);
    function setText(id, txt){ const el = $(id); if(el) el.textContent = txt; }

    // Demo KPI values
    setText('kpiPrice', '$1.234');
    setText('kpiChange', '+3.2%');
    setText('kpiVol', '$12.3M');
    setText('kpiMcap', '$1.2B');
    setText('kpiOI', '$8.4M');
    setText('lastUpdated', new Date().toLocaleTimeString());
    setText('hypePrice', '$1.234');
    setText('hypeChange', '+3.2%');

    // Mock whales
    const whaleList = $('whaleList');
    if(whaleList){
      whaleList.innerHTML = '';
      ['HYPE/USDC long $250k','HYPE/ETH short $180k','BTC/USDC long $500k'].forEach(t=>{
        const d = document.createElement('div');
        d.className = 'mb-2 p-2 glass rounded text-sm';
        d.textContent = t;
        whaleList.appendChild(d);
      });
    }

    // MMIA indicator (mock)
    const mmia = $('mmiaIndicator');
    const mmiaColor = $('mmiaColor');
    if(mmia){ mmia.textContent = 'Bullish'; mmiaColor.textContent = 'Green'; mmiaColor.style.color = '#00ff7f'; }

    // HIP expand/collapse (mock details)
    document.querySelectorAll('.hip-row').forEach(row=>{
      row.addEventListener('click', ()=>{
        const hip = row.dataset.hip || 'HIP';
        // if already expanded, remove
        const next = row.nextElementSibling;
        if(next && next.classList && next.classList.contains('hip-expanded')){
          next.remove();
          return;
        }
        // collapse any other expanded
        document.querySelectorAll('.hip-expanded').forEach(e=>e.remove());
        const exp = document.createElement('div');
        exp.className = 'hip-expanded';
        exp.innerHTML = `
          <div class="text-sm"><strong>${hip}</strong> — One-line explanation of the proposal.</div>
          <div class="text-sm muted mt-1">What it brings: Short sentence about benefits for users/stakers.</div>
          <div class="mt-2 grid grid-cols-2 gap-2">
            <div>
              <div class="font-semibold text-sm text-green-400">Top Aye validators</div>
              <div class="text-sm mt-1">ValidatorA · 12k</div>
              <div class="text-sm">ValidatorB · 8k</div>
              <div class="text-sm">ValidatorC · 5k</div>
            </div>
            <div>
              <div class="font-semibold text-sm text-red-400">Top Nay validators</div>
              <div class="text-sm mt-1">ValidatorX · 3k</div>
              <div class="text-sm">ValidatorY · 2k</div>
              <div class="text-sm">ValidatorZ · 1k</div>
            </div>
          </div>
          <div class="mt-2"><a href="https://hyperliquid.gitbook.io/hyperliquid-docs/hyperliquid-improvement-proposals-hips" target="_blank" class="brand-green text-sm">View on GitBook →</a></div>
        `;
        row.parentNode.insertBefore(exp, row.nextSibling);
      });
    });

    // Chart enlarge modal logic (works with any canvas id)
    function openChartModal(title, canvasId, desc){
      const modalBackdrop = document.getElementById('modalBackdrop');
      const modalBody = document.getElementById('modalBody');
      const modalTitle = document.getElementById('modalTitle');
      const modalDesc = document.getElementById('modalDesc');
      modalTitle.textContent = title || 'Chart';
      modalDesc.textContent = desc || '';
      modalBody.innerHTML = '';
      // clone canvas into modal (create new canvas and copy image)
      const src = document.getElementById(canvasId);
      if(!src) return;
      const clone = document.createElement('canvas');
      clone.width = Math.min(1200, window.innerWidth * 0.9);
      clone.height = 500;
      clone.style.width = '100%';
      clone.style.height = 'auto';
      modalBody.appendChild(clone);
      // try to draw source canvas into clone (if same-origin)
      try {
        const ctx = clone.getContext('2d');
        ctx.drawImage(src, 0, 0, clone.width, clone.height);
      } catch(e){
        // fallback: show placeholder
        clone.getContext('2d').fillStyle = '#111';
        clone.getContext('2d').fillRect(0,0,clone.width,clone.height);
        clone.getContext('2d').fillStyle = '#fff';
        clone.getContext('2d').fillText('Preview not available', 20, 30);
      }
      modalBackdrop.style.display = 'flex';
    }
    document.getElementById('modalClose').addEventListener('click', ()=>{ document.getElementById('modalBackdrop').style.display='none'; });

    // Attach click handlers to canvases to open modal with description
    const chartMap = {
      'hsiChart': { title: 'HSI (Hyperliquid Sentiment Index)', desc: 'HSI is a composite of Sentiment, Whales, Open Interest, Funding and Liquidity. Main index shown in center.' },
      'giypChart': { title: 'GIYP Predictor', desc: 'Governance Impact Yield Predictor — estimates yield impact of governance changes.' },
      'sentimentChart': { title: 'Sentiment (Headlines + Reddit)', desc: 'Aggregated sentiment score from headlines and Reddit posts.' },
      'oiChart': { title: 'Open Interest', desc: 'Open interest across major markets — longs vs shorts.' }
    };
    Object.keys(chartMap).forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.addEventListener('click', ()=> openChartModal(chartMap[id].title, id, chartMap[id].desc));
    });

    // Simple Chart.js fallback (if Chart is loaded)
    function initCharts(){
      if(typeof Chart === 'undefined') return;
      // HSI bar
      const hsiCtx = document.getElementById('hsiChart')?.getContext('2d');
      if(hsiCtx) new Chart(hsiCtx, { type:'bar', data:{ labels:['Sentiment','Whales','OI','Funding','Liquidity'], datasets:[{ data:[60,55,50,48,65], backgroundColor:['#00FF7F','#00CC66','#FF0033','#FFAA00','#00A3FF'] }] }, options:{ responsive:true, maintainAspectRatio:false, scales:{ y:{ beginAtZero:true, max:100 } } } });
      // GIYP
      const giypCtx = document.getElementById('giypChart')?.getContext('2d');
      if(giypCtx) new Chart(giypCtx, { type:'line', data:{ labels:['T-2','T-1','Now'], datasets:[{ data:[4.5,5.0,5.8], borderColor:'#00FFFF', fill:false }] }, options:{ responsive:true, maintainAspectRatio:false } });
      // Sentiment donut
      const sCtx = document.getElementById('sentimentChart')?.getContext('2d');
      if(sCtx) new Chart(sCtx, { type:'doughnut', data:{ labels:['Positive','Negative'], datasets:[{ data:[75,25], backgroundColor:['#00FF7F','#FF0033'] }] }, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } } } });
      // OI
      const oiCtx = document.getElementById('oiChart')?.getContext('2d');
      if(oiCtx) new Chart(oiCtx, { type:'bar', data:{ labels:['-2h','-1h','Now'], datasets:[{ label:'Longs', data:[1100000,1200000,1250000], backgroundColor:'#00FF7F' }, { label:'Shorts', data:[850000,900000,950000], backgroundColor:'#FF0033' }] }, options:{ responsive:true, maintainAspectRatio:false } });
    }
    window.addEventListener('load', initCharts);

    // Theme toggle (simple)
    const themeToggle = document.getElementById('themeToggle');
    if(themeToggle){
      themeToggle.addEventListener('click', ()=>{
        document.body.classList.toggle('light');
        themeToggle.textContent = document.body.classList.contains('light') ? 'Light' : 'Dark';
      });
    }

    // Ensure lists have scroll if content grows
    ['newsList','whaleList','govSnapshot'].forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.style.maxHeight = '160px';
      if(el) el.style.overflowY = 'auto';
    });

  </script>

  <!-- Optional external app.js (kept for compatibility) -->
  <script src="./js/app.js"></script>
</body>
</html>
